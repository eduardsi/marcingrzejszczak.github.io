
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Simulation of Time Consuming Actions in Integration Tests - TOO MUCH CODING BLOG</title>
  <meta name="author" content="Marcin Grzejszczak">

  
  <meta name="description" content="Simulation of Time Consuming Actions in Integration Tests written in answer, integration tests, java, mockito Hi!Quite recently in one of my &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://toomuchcoding.com/blog/2012/10/07/simulation-of-time-consuming-actions-in">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="TOO MUCH CODING BLOG" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  

</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>Simulation of Time Consuming Actions in Integration Tests</h1>
        <div class="meta">
          written 








  



<time datetime="2012-10-07T22:47:00+02:00" pubdate data-updated="true"></time>
          

in
<span class="categories">
  
    <a class='category' href='/blog/categories/answer/'>answer</a>, <a class='category' href='/blog/categories/integration-tests/'>integration tests</a>, <a class='category' href='/blog/categories/java/'>java</a>, <a class='category' href='/blog/categories/mockito/'>mockito</a>
  
</span>


        </div>
        <div class='post'>
<br /><br />Hi!<br /><br />Quite recently in one of my projects I had a situation in which I needed to create an integration test for the application. That's not very odd isn't it? :)<br /><br />What was interesting was the fact that the logic of the app involved some concurrency issues and one of the components had to connect to an external service which would take a couple of seconds. Since in the integration test there was no need to make the actual connection, the component needed to be mocked. What about the simulation of the time consuming action? Well, let's take a look at the way I did it...<br />
<!--more-->
<br /><b>The task.</b><br /><br /><pre class="brush:java">package pl.grzejszczak.marcin;<br /><br />import org.slf4j.Logger;<br />import org.slf4j.LoggerFactory;<br /><br />/**<br /> * Service that does some things including processing of the external service<br /> * <br /> * @author marcin<br /> * <br /> */<br />public class SomeTask implements Runnable {<br /><br /> private static final Logger LOGGER = LoggerFactory.getLogger(SomeTask.class);<br /><br /> // Service is injected via a dependency injection system<br /> private Processable timeConsumingExternalService;<br /><br /> private void methodThatConnectsToExternalServices() {<br />  // connects to an external service and spends a couple of seconds there<br />  LOGGER.debug("Before processing");<br />  timeConsumingExternalService.process();<br />  LOGGER.debug("After processing");<br />  // some other things to do<br /> }<br /><br /> public void run() {<br />  methodThatConnectsToExternalServices();<br /> }<br /><br /> public void setTimeConsumingExternalService(Processable timeConsumingExternalService) {<br />  this.timeConsumingExternalService = timeConsumingExternalService;<br /> }<br /><br />}</pre><b>The integration test.</b><br /><br /><pre class="brush:java">package pl.grzejszczak.marcin;<br /><br />import java.util.concurrent.ExecutorService;<br />import java.util.concurrent.Executors;<br /><br />import org.mockito.Mockito;<br />import org.mockito.invocation.InvocationOnMock;<br />import org.mockito.stubbing.Answer;<br />import org.slf4j.Logger;<br />import org.slf4j.LoggerFactory;<br /><br />public class ServiceIntegrationTest {<br /><br /> private static final Logger LOGGER = LoggerFactory.getLogger(ServiceIntegrationTest.class);<br /><br /> private ExecutorService executorService = Executors.newCachedThreadPool();<br /> private Processable timeConsumingExternalServiceMock = Mockito.mock(Processable.class);<br /> private SomeTask someTask = new SomeTask();<br /><br /> public ServiceIntegrationTest() {<br />  initializeMocks();<br /> }<br /><br /> private void initializeMocks() {<br />  Mockito.doAnswer(new Answer&lt;Object&gt;() {<br />   public Object answer(InvocationOnMock invocation) throws Throwable {<br />    // Simulation of connection to external services<br />    LOGGER.debug("Sleeping");<br />    Thread.sleep(5000);<br />    LOGGER.debug("Stopped Sleeping");<br />    return null;<br />   }<br />  }).when(timeConsumingExternalServiceMock).process();<br />  // Inject the mock to the Task - in any possible way<br />  someTask.setTimeConsumingExternalService(timeConsumingExternalServiceMock);<br /> }<br /><br /> public void executeTest() {<br />  executorService.execute(someTask);<br /> }<br /><br /> public static void main(String args[]) {<br />  ServiceIntegrationTest integrationTest = new ServiceIntegrationTest();<br />  integrationTest.executeTest();<br /> }<br />}<br /></pre><br /><br />And the output to the console:<br /><br />2012-10-07 22:42:37,378 DEBUG pl.grzejszczak.marcin.SomeTask:21 Before processing<br />2012-10-07 22:42:37,389 DEBUG pl.grzejszczak.marcin.ServiceIntegrationTest:28 Sleeping<br />2012-10-07 22:42:42,390 DEBUG pl.grzejszczak.marcin.ServiceIntegrationTest:30 Stopped Sleeping<br />2012-10-07 22:42:42,392 DEBUG pl.grzejszczak.marcin.SomeTask:23 After processing<br /><br />Let's take a closer look at the most important part in which an Answer for the execution of the service is being created  <br /><pre class="brush:java">Mockito.doAnswer(new Answer&lt;Object&gt;() {<br />   public Object answer(InvocationOnMock invocation) throws Throwable {<br />    // Simulation of connection to external services<br />    LOGGER.debug("Sleeping");<br />    Thread.sleep(5000);<br />    LOGGER.debug("Stopped Sleeping");<br />    return null;<br />   }<br />  }).when(timeConsumingExternalServiceMock).process();<br /></pre><br />This piece of code changes the default action that should be done by the given object on a given method execution. In this particular case we had to mock a method that returns void - that's why we start with doAnswer(...) and finish with when(...).process(). <br /><br />That is how inside the integration test I managed to create a simulation of waiting for the service to finish. If you have any ideas or comments on how you would do it in another way please feel free to post a comment below :) </div>


        <hr class="divider-short"/>

        
      </div>
    </div>
  </div>
</article>

<hr class="divider-short"/>

<div class="archive-link">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        
          <a class="pull-left" href="/blog/2012/10/06/and-so-we-code/" title="Previous Post: And so we code...">&laquo; Previous: And so we code...</a>
        

        
          <a class="pull-right" href="/blog/2012/10/16/calculating-coherence-cluster-size-on/" title="Next Post: Calculating Coherence cluster size on a remote server using JMX">Next: Calculating Coherence cluster size on a remote server using JMX &raquo;</a>
        
      </div>
    </div>
  </div>
</div>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>

<div class="col-md-2">
  <div class="social-icon-list">
    
    <a href="https://twitter.com/mgrzejszczak"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    

    
    <a href="https://github.com/marcingrzejszczak"><img src="/images/glyphicons_social_21_github.png"/></a>
    

    
    <a href="https://linkedin.com/in/marcin-grzejszczak-15565119"><img src="/images/glyphicons_social_17_linked_in.png"/></a>
    

    
    <a href="mailto:blog@toomuchcoding.com"><img src="/images/glyphicons_social_39_e-mail.png"/></a>
    
  </div>
</div>

<div class="pull-right">
  <h4>Powered by <a href="http://octopress.org/">Octopress</a>. Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.</h4>
</div>


    </div>
  </div>
</footer>

    
  </body>
</html>
